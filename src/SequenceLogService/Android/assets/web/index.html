<!DOCTYPE html>
<head>
<meta charset="UTF-8">
<link rel="shortcut icon" href="http://<? DOMAIN ?>/images/SequenceLogService.ico">
<title>Sequence Log Service</title>
<link type="text/css" rel="stylesheet" href="SequenceLogService.css" media="screen" />
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript" src="http://<? DOMAIN ?>/js/jquery.mousewheel-3.0.6.pack.js"></script>
<script type="text/javascript" src="http://<? DOMAIN ?>/js/slog.service.js"></script>
<script type="text/javascript">
$(function()
{
    // ブラウザサイズ変更時のハンドラ
    function onSize()
    {
        var canvas =    $('#logViewer').get(0);
        canvas.width =  $('#logViewer').parent().width() * 95 / 100;
        canvas.height = $.sequenceLogList.size.height * $.sequenceLogList.logVisibleLineCount;

        $.sequenceLogList.draw();
    }

    // シーケンスログファイル一覧更新
    function updateLogFileList(data)
    {
        var list = '';

        $.each(data, function(i, obj)
        {
            list = list +
                '<tr>' +
                    '<td>'               + obj.creationTime  + '</td>' +
                    '<td>'               + obj.lastWriteTime + '</td>' +
                    '<td><a href="#">'   + obj.canonicalPath + '</a></td>' +
                    '<td align="right">' + obj.size          + '</td>' +
                '</tr>';
        });

        $('#logFileList').find('tr:gt(0)').remove();
        $('#logFileList').append(list);

        $('a[href=#]').click(function()
        {
            $.ajax(
            {
                url: '/',
                type: 'POST',
                dataType: 'text',
                data:
                {
                    fileName: $(this).text()
                }
            });
            return false;
        });
    }

    // 初期設定
    var domain = location.href.split('/')[2];
    $.sequenceLogList.init(domain, updateLogFileList, 'logViewer');

    $(window).bind('resize', onSize);
    onSize();
});
</script>
</head>

<body>
<h1>Sequence Log Service</h1>

<!-- シーケンスログファイル一覧 -->
<div align="center">
    <table id="logFileList">
        <tr>
            <th>開始日時</th>
            <th>終了日時</th>
            <th>ログファイル名</th>
            <th>サイズ</th>
        </tr>
    </table>
</div>
<br />

<!-- 受信ログ表示エリア -->
<div id="logViewerFrame"><canvas id="logViewer"></canvas></div>
<br />

<!-- フッター -->
<hr />
<div align="right">
    Copyright (c) 2013 <a href="http://<? DOMAIN ?>" target="_blank"><? DOMAIN ?></a> All rights reserved.
</div>
</body>
</html>
